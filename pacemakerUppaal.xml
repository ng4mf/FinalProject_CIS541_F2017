<?xml version="1.0" encoding="utf-8"?><!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.1//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_1.dtd'><nta><declaration>// Place global declarations here.
clock x;

broadcast chan VPace, VSense;

chan alarm;

// Measurements are in milliseconds
// VRP has to be between 150ms to 500ms
const int VRP = 300;</declaration><template><name x="5" y="5">Heart</name><declaration>// Measurements are in milliseconds

const int minWait = 900;
const int maxWait = 1400;</declaration><location id="id0" x="280" y="144"><name x="263" y="161">Ready</name><label kind="invariant" x="237" y="186">x &lt;= maxWait</label></location><init ref="id0"/><transition><source ref="id0"/><target ref="id0"/><label kind="guard" x="59" y="110">x &gt;= minWait</label><label kind="synchronisation" x="76" y="136">VSense!</label><label kind="assignment" x="84" y="161">x = 0</label><nail x="144" y="84"/><nail x="144" y="212"/></transition><transition><source ref="id0"/><target ref="id0"/><label kind="synchronisation" x="433" y="110">VPace?</label><label kind="assignment" x="433" y="135">x = 0</label><nail x="424" y="76"/><nail x="424" y="220"/></transition></template><template><name>Ventricle</name><declaration>// all measurements are in milliseconds

// Lower bound for Rate Limit is 40bpm
int[1492,1508] LRI;

// Upper bound for Rate Limit is 100bpm
int[592,608] URI;

// Hysteresis rate interval = 30bpm
const int HRI = 2000;

//int[URI, LRI] HRI = LRI;

int RI = HRI;

bool started, natural_beat;
</declaration><location id="id1" x="24" y="-376"></location><location id="id2" x="-200" y="-376"><name x="-210" y="-406">Init</name><committed/></location><location id="id3" x="619" y="-376"><name x="627" y="-410">WaitVRP</name><label kind="invariant" x="627" y="-359">x &lt;= VRP</label></location><location id="id4" x="24" y="-376"><name x="-35" y="-410">WaitRI</name><label kind="invariant" x="-35" y="-368">x &lt;= RI</label></location><location id="id5" x="177" y="-376"><committed/></location><location id="id6" x="304" y="-376"><name x="294" y="-410">Sensed</name><committed/></location><init ref="id2"/><transition><source ref="id2"/><target ref="id4"/><label kind="select" x="-168" y="-424">i:int[592,608],
j:int[1492,1508]</label><label kind="assignment" x="-148" y="-376">URI = i,
LRI = j</label></transition><transition><source ref="id5"/><target ref="id6"/><label kind="guard" x="211" y="-359">x &gt;= URI</label><nail x="194" y="-359"/><nail x="287" y="-359"/></transition><transition><source ref="id5"/><target ref="id6"/><label kind="guard" x="212" y="-435">x &lt; URI</label><label kind="synchronisation" x="212" y="-418">alarm!</label><nail x="194" y="-393"/><nail x="287" y="-393"/></transition><transition><source ref="id4"/><target ref="id5"/><label kind="synchronisation" x="92" y="-393">VSense?</label></transition><transition><source ref="id3"/><target ref="id4"/><label kind="guard" x="177" y="-317">x &gt;= VRP</label><label kind="assignment" x="381" y="-316">started = true</label><nail x="568" y="-291"/><nail x="84" y="-291"/></transition><transition><source ref="id4"/><target ref="id3"/><label kind="guard" x="186" y="-486">x &gt;= RI</label><label kind="synchronisation" x="279" y="-486">VPace!</label><label kind="assignment" x="347" y="-486">x = 0, RI = LRI, natural_beat=false</label><nail x="92" y="-461"/><nail x="568" y="-461"/></transition><transition><source ref="id6"/><target ref="id3"/><label kind="assignment" x="346" y="-393">x = 0, RI = HRI, natural_beat=true</label><nail x="584" y="-376"/></transition></template><template><name>Observer</name><declaration>int vstarted, tv;

bool alarmSet=false;</declaration><location id="id7" x="-170" y="-246"><name x="-238" y="-280">VSensed</name><committed/></location><location id="id8" x="110" y="-25"><name x="127" y="-42">VPaced</name><committed/></location><location id="id9" x="-170" y="-25"><name x="-238" y="-34">WaitRL</name></location><init ref="id9"/><transition><source ref="id9"/><target ref="id9"/><label kind="synchronisation" x="-195" y="34">alarm?</label><label kind="assignment" x="-221" y="51">alarmSet=true</label><nail x="-144" y="34"/><nail x="-204" y="34"/></transition><transition><source ref="id7"/><target ref="id7"/><label kind="synchronisation" x="-110" y="-259">alarm?</label><label kind="assignment" x="-110" y="-242">alarmSet=true</label><nail x="-110" y="-212"/><nail x="-110" y="-272"/><nail x="-110" y="-280"/></transition><transition><source ref="id8"/><target ref="id9"/><label kind="assignment" x="-93" y="34">vstarted = 0, tv = 0</label><nail x="-34" y="34"/></transition><transition><source ref="id7"/><target ref="id9"/><label kind="assignment" x="-102" y="-144">vstarted = 0, tv = 0</label><nail x="-110" y="-127"/></transition><transition><source ref="id9"/><target ref="id7"/><label kind="synchronisation" x="-238" y="-144">VSense?</label><label kind="assignment" x="-289" y="-127">alarmSet=false</label></transition><transition><source ref="id9"/><target ref="id8"/><label kind="synchronisation" x="-68" y="-42">VPace?</label><label kind="assignment" x="-85" y="-25">alarmSet=false</label></transition></template><system>// Place template instantiations here.
// Process = Template();
// List one or more processes to be composed into a system.
system Heart, Ventricle, Observer;
    </system></nta>